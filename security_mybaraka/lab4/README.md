# Защищенный чат

Приложение для защищенного обмена сообщениями с поддержкой шифрования, цифровой подписи и аутентификации.

## Архитектура

Приложение построено на клиент-серверной архитектуре с использованием следующих компонентов:

- **GUI**: PyQt5 для создания графического интерфейса
- **Криптография**: 
  - RC4 для потокового шифрования сообщений
  - RSA для цифровой подписи файлов
  - Диффи-Хеллман для обмена ключами
  - MD5 для хеширования паролей
- **База данных**: SQLite для хранения пользователей
- **Сеть**: TCP сокеты для обмена данными

## Диаграммы процессов

### Регистрация

```mermaid
sequenceDiagram
    participant C as Клиент
    participant S as Сервер
    participant DB as База данных

    C->>S: REGISTER|login|password
    S->>DB: Проверка существования пользователя
    alt Пользователь существует
        S->>C: EXISTS
    else Пользователь не существует
        S->>DB: Сохранение хеша пароля
        S->>C: SUCCESS
    end
```

### Аутентификация

```mermaid
sequenceDiagram
    participant C as Клиент
    participant S as Сервер
    participant DB as База данных

    C->>S: AUTH|login
    S->>DB: Поиск пользователя
    alt Пользователь не найден
        S->>C: NOT_FOUND
    else Пользователь найден
        S->>DB: Генерация SW, обновление времени
        S->>C: hash(SW)
        C->>S: hash(hash(SW) + hash(password))
        alt Хеши совпадают
            S->>C: SUCCESS
            Note over C,S: Начало обмена ключами DH
            S->>C: A|g|p
            C->>S: B
            Note over C,S: Вычисление K = g^(ab) mod p
        else Хеши не совпадают
            S->>C: WRONG_PASSWORD
        end
    end
```

### Обмен сообщениями и файлами

```mermaid
sequenceDiagram
    participant C as Клиент
    participant S as Сервер

    Note over C,S: Установлено RC4 шифрование с ключом K
    
    alt Отправка сообщения
        C->>S: RC4(message)
        S->>C: RC4(response)
    else Подпись файла
        C->>S: KEYS|e|n (RSA публичный ключ)
        C->>S: ECP|file_data|signature
        Note over S: Проверка подписи
        S->>C: Результат проверки
    end
```

## Структура проекта

```
lab4/
├── main.py                 # Главное окно приложения
├── c_client/              # Клиентская часть
│   └── main.py            # Реализация клиента
├── s_client/              # Серверная часть
│   └── main.py            # Реализация сервера
└── utils/                 # Вспомогательные модули
    ├── __init__.py        # Инициализация пакета
    ├── crypto.py          # Криптографические алгоритмы
    ├── database.py        # Работа с БД
    ├── helpers.py         # Вспомогательные функции
    └── logger.py          # Система логирования
```

## Основные компоненты

### Криптографические алгоритмы (crypto.py)
- **RC4**: Потоковое шифрование сообщений
- **RSA**: Генерация ключей и цифровая подпись

### База данных (database.py)
- Хранение пользователей и их данных
- Управление сессиями и SW значениями

### Вспомогательные функции (helpers.py)
- Генерация криптографических параметров
- Валидация учетных данных
- Хеширование MD5

### Логирование (logger.py)
- Запись действий в файлы логов
- Отслеживание ошибок и событий

## Безопасность

1. **Аутентификация**:
   - Хеширование паролей MD5
   - Механизм SW для защиты от повторных атак
   - Временные метки для контроля сессий

2. **Шифрование**:
   - RC4 для сообщений
   - Протокол Диффи-Хеллмана для обмена ключами
   - RSA для цифровой подписи файлов

3. **Валидация**:
   - Проверка длины и состава логинов/паролей
   - Контроль размера сообщений и файлов
   - Проверка цифровых подписей

## Требования к паролю

- Минимум 5 символов
- Максимум 30 символов
- Только латинские буквы, цифры и символы ?!&
- Минимум одна заглавная буква
- Минимум одна цифра

## Логирование

Система создает отдельные лог-файлы для клиента и сервера:
- client.log - события клиента
- server.log - события сервера
- main.log - общие события приложения

## Запуск приложения

1. Запустите главное приложение:
```bash
python main.py
```

2. В открывшемся окне:
   - Слева - клиентская часть (регистрация/вход)
   - Справа - серверная часть (ожидание подключений)
   - Внизу - просмотр логов и базы данных в реальном времени
