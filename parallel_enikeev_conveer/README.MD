# Параллельный Конвейер с использованием MPI

## Описание
Данный проект реализует параллельный конвейер обработки данных с использованием технологии MPI (Message Passing Interface). Конвейер состоит из нескольких этапов обработки данных, где каждый этап может выполняться на нескольких процессах параллельно.

## Архитектура системы

```mermaid
graph TD
    G[Генератор<br/>Ранг 0] --> W1[Работник Ф1<br/>Ранг 1]
    G --> W1_2[Работник Ф1<br/>Ранг N]
    W1 --> W2[Работник Ф2<br/>Ранг N+1]
    W1_2 --> W2
    W1 --> W2_2[Работник Ф2<br/>Ранг N+M]
    W1_2 --> W2_2
    W2 --> W3[Работник Ф3<br/>Ранг N+M+1]
    W2_2 --> W3
    W2 --> W3_2[Работник Ф3<br/>Ранг N+M+K]
    W2_2 --> W3_2
    W3 --> C[Коллектор<br/>Последний ранг]
    W3_2 --> C

    style G fill:#f9f,stroke:#333,stroke-width:2px
    style C fill:#9ff,stroke:#333,stroke-width:2px
    style W1 fill:#ff9,stroke:#333,stroke-width:2px
    style W1_2 fill:#ff9,stroke:#333,stroke-width:2px
    style W2 fill:#f99,stroke:#333,stroke-width:2px
    style W2_2 fill:#f99,stroke:#333,stroke-width:2px
    style W3 fill:#9f9,stroke:#333,stroke-width:2px
    style W3_2 fill:#9f9,stroke:#333,stroke-width:2px
```

## Компоненты системы

### 1. Генератор (Ранг 0)
- Создает последовательность чисел для обработки
- Распределяет данные между работниками первого этапа
- Отправляет сигналы завершения работы
- Контролирует начало работы конвейера

### 2. Работники (Ранги 1..N-1)
Выполняют три различные функции обработки данных:

#### Ф1 (Первый этап)
- Увеличивает входное значение на 1
- Имитация задержки: 100 мс
- Пример: input → input + 1

#### Ф2 (Второй этап)
- Возводит число в квадрат
- Имитация задержки: 200 мс
- Пример: input → input * input

#### Ф3 (Третий этап)
- Передает значение без изменений
- Имитация задержки: 150 мс
- Пример: input → input

### 3. Коллектор (Последний ранг)
- Собирает обработанные данные
- Вычисляет итоговую сумму всех значений
- Контролирует завершение работы конвейера
- Выводит финальный результат

## Особенности реализации

### Межпроцессное взаимодействие
- Использует MPI для передачи сообщений между процессами
- Поддерживает динамическое распределение нагрузки
- Обеспечивает синхронизацию между этапами обработки

### Структура сообщений
```cpp
struct DataMessage {
    int value;              // Значение для обработки
    int source;             // Исходный процесс
    bool is_termination;    // Флаг завершения
    double timestamp;       // Временная метка
};
```

### Система логирования
- Каждое действие логируется с временной меткой
- Синхронизированный вывод через мьютекс
- Отслеживание времени выполнения операций
- Форматированный вывод с микросекундной точностью

### Обработка завершения
- Корректное завершение всех процессов
- Обработка сигналов завершения
- Очистка очередей сообщений
- Финальная агрегация результатов

## Конфигурация

Настройка конвейера осуществляется через структуру `PipelineConfig`:
```cpp
struct PipelineConfig {
    std::vector<std::shared_ptr<PipelineFunction>> functions;  // Функции обработки
    std::vector<int> proc_per_func;                           // Процессы на функцию
    bool use_reduction;                                       // Флаг редукции
    int generator_count;                                      // Количество чисел
    int generator_start;                                      // Начальное значение
    int generator_step;                                       // Шаг генерации
};
```

## Производительность
- Параллельная обработка данных
- Балансировка нагрузки между работниками
- Минимизация времени простоя процессов
- Масштабируемость при добавлении новых работников

## Требования
- Компилятор с поддержкой C++11 или выше
- Реализация MPI (например, OpenMPI или MPICH)
- Поддержка многопоточности (std::thread)
- CMake для сборки проекта
